<div class="container my-5">

  <!-- Bienvenida -->
  <div class="text-center mb-5">
    <h2 class="text-light">ğŸ“Š Bienvenido a tu panel de inventario</h2>
    <p class="text-secondary">
      Visualiza estadÃ­sticas clave, accede a productos y gestiona tus categorÃ­as.
    </p>
  </div>

  <!-- CategorÃ­as -->
  <div class="row g-4 justify-content-center mb-5">
    <div 
      class="col-12 col-sm-6 col-md-4 col-lg-3" 
      *ngFor="let categoria of categoriasPaginadas()"
    >
      <div class="card card-option h-100">
        <img 
          [src]="getRutaImagen(categoria)"
          [alt]="categoria.name"
          class="category-img"
          (error)="reemplazarImagenPorDefecto(categoria)"
        />
        <div class="card-body">
          <h5 class="card-title">{{ categoria.name }}</h5>
          <p class="card-text small">
            {{ categoria.description || 'Sin descripciÃ³n' }}
          </p>
          <a 
            [routerLink]="['/productos/categoria', categoria.id]" 
            class="btn btn-outline-light btn-sm mt-2"
          >
            Ver productos
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- PaginaciÃ³n -->
  <div class="text-center mt-4" *ngIf="totalPaginas() > 1">
    <button
      *ngFor="let pagina of obtenerPaginas()"
      (click)="cambiarPagina(pagina)"
      [class.active]="pagina === currentPage"
      class="btn btn-outline-light mx-1"
    >
      {{ pagina }}
    </button>
  </div>

  <div class="row g-4 text-center mb-5">

  <!-- Total CategorÃ­as (clickeable) -->
  <div class="col-6 col-md-4">
    <div 
      class="bg-dark border border-success rounded p-3 shadow-sm"
      style="cursor: pointer;"
      [routerLink]="['/stock']"
    >
      <h6 class="text-secondary mb-1">ğŸ“ Total CategorÃ­as</h6>
      <h3 class="text-light">{{ categorias.length || 0 }}</h3>
    </div>
  </div>

  <!-- Total Productos (clickeable) -->
  <div class="col-6 col-md-4">
    <div 
      class="bg-dark border border-info rounded p-3 shadow-sm"
      style="cursor: pointer;"
      [routerLink]="['/productos']"
    >
      <h6 class="text-secondary mb-1">ğŸ›’ Total Productos</h6>
      <h3 class="text-light">{{ totalProductos || 0 }}</h3>
    </div>
  </div>

  <!-- Ãšltima actualizaciÃ³n (no clickeable) -->
  <div class="col-12 col-md-4">
    <div class="bg-dark border border-warning rounded p-3 shadow-sm">
      <h6 class="text-secondary mb-1">ğŸ“… Ãšltima actualizaciÃ³n</h6>
      <h3 class="text-light">{{ resumen[0]?.ultima_actualizacion || 'N/A' }}</h3>
    </div>
  </div>

</div>


  <!-- GrÃ¡ficas -->
  <div class="row justify-content-center mt-4 g-4">
    <!-- MÃ¡s vendidos -->
    <div class="col-12 col-md-6">
      <div class="chart-card bg-dark border border-success text-white">
        <h5 class="mb-3">ğŸ“ˆ Productos mÃ¡s vendidos</h5>
        <div *ngIf="masVendidos.length; else sinMasVendidos">
          <div *ngFor="let p of masVendidos" class="mb-3">
            <div class="d-flex justify-content-between">
              <strong>{{ p.nombre }}</strong>
              <small>{{ p.vendidos }} unidades</small>
            </div>
            <div class="progress">
              <div 
                class="progress-bar bg-success"
                role="progressbar"
                [style.width.%]="(p.vendidos / maxVendidos) * 100"
                [attr.aria-valuenow]="p.vendidos"
                aria-valuemin="0"
                [attr.aria-valuemax]="maxVendidos"
              ></div>
            </div>
          </div>
        </div>
        <ng-template #sinMasVendidos>
          <p class="text-secondary">No hay productos registrados aÃºn.</p>
        </ng-template>
      </div>
    </div>

    <!-- Menos vendidos -->
    <div class="col-12 col-md-6">
      <div class="chart-card bg-dark border border-danger text-white">
        <h5 class="mb-3">ğŸ“‰ Productos menos vendidos</h5>
        <div *ngIf="menosVendidos.length; else sinMenosVendidos">
          <div *ngFor="let p of menosVendidos" class="mb-3">
            <div class="d-flex justify-content-between">
              <strong>{{ p.nombre }}</strong>
              <small>{{ p.vendidos }} unidades</small>
            </div>
            <div class="progress">
              <div 
                class="progress-bar bg-danger"
                role="progressbar"
                [style.width.%]="(p.vendidos / maxVendidos) * 100"
                [attr.aria-valuenow]="p.vendidos"
                aria-valuemin="0"
                [attr.aria-valuemax]="maxVendidos"
              ></div>
            </div>
          </div>
        </div>
        <ng-template #sinMenosVendidos>
          <p class="text-secondary">Todos los productos tienen cero ventas.</p>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- ğŸ”” Alerta de categorÃ­as con stock bajo -->
  <div *ngIf="alertasStockBajo?.length" class="alert alert-danger mt-5">
    <h5 class="text-white">âš  CategorÃ­as con stock bajo:</h5>
    <ul class="mb-0">
      <li *ngFor="let cat of alertasStockBajo">
        {{ cat.categoria }}: {{ cat.stock_total }} / mÃ­nimo {{ cat.stock_minimo }}
      </li>
    </ul>
  </div>
</div>
